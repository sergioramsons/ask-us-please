<?xml version="1.0" encoding="UTF-8"?>
<Crm Name="Lovable Helpdesk" Version="1" Country="US" SupportsEmojis="false">
  <Number Prefix="AsIs" MaxLength="[MaxLength]"/>
  <Connection MaxConcurrentRequests="5"/>
  <Parameters>
    <Parameter Name="ServerUrl" Type="String" Title="Helpdesk Server URL" Default="thzdazcmswmeolaiijml.supabase.co"/>
    <Parameter Name="ApiToken" Type="Password" Title="API Token" Default=""/>
    <Parameter Name="Protocol" Type="String" Title="Protocol" Default="https"/>
  </Parameters>
  <Authentication Type="No"/>
  <Scenarios>
    <Scenario Id="">
      <Request Url="[Protocol]://[ServerUrl]/functions/v1/yeastar-contacts" Method="GET">
        <Parameter Name="phone" Value="[Number]"/>
      </Request>
      <Rules>
        <Rule Type="Any">users</Rule>
      </Rules>
      <Variables>
        <Variable Name="ContactID" Path="users.0.id"/>
        <Variable Name="FirstName" Path="users.0.first_name"/>
        <Variable Name="LastName" Path="users.0.last_name"/>
        <Variable Name="Email" Path="users.0.email"/>
        <Variable Name="Phone" Path="users.0.phone"/>
        <Variable Name="Company" Path="users.0.company"/>
      </Variables>
      <Outputs>
        <Output Type="ContactUrl" Value="https://helpdesk.bernsergsolutions.com/yeastar?popup=helpdesk&amp;phone=[Number]&amp;name=[FirstName] [LastName]"/>
        <Output Type="FirstName" Value="[FirstName]"/>
        <Output Type="LastName" Value="[LastName]"/>
        <Output Type="Email" Value="[Email]"/>
        <Output Type="Phone" Value="[Phone]"/>
        <Output Type="Company" Value="[Company]"/>
        <Output Type="EntityType" Value="Contacts"/>
        <Output Type="EntityId" Value="[ContactID]"/>
      </Outputs>
    </Scenario>
    <Scenario Id="CreateContactRecordFromClient">
      <Request Url="[Protocol]://[ServerUrl]/functions/v1/yeastar-contacts" Method="POST" 
               RequestEncoding="JSON" RequestContentType="application/json">
        <Parameter Name="" Value="{&quot;first_name&quot;: &quot;[CreateContactFirstName]&quot;, &quot;last_name&quot;: &quot;[CreateContactLastName]&quot;, &quot;phone&quot;: &quot;[CreateContactPhoneNumber]&quot;, &quot;email&quot;: &quot;[CreateContactEmail]&quot;, &quot;company&quot;: &quot;[CreateContactCompany]&quot;}"/>
      </Request>
      <Rules>
        <Rule Type="Any">id</Rule>
      </Rules>
      <Variables>
        <Variable Name="ContactID" Path="id"/>
        <Variable Name="FirstName" Path="first_name"/>
        <Variable Name="LastName" Path="last_name"/>
        <Variable Name="Email" Path="email"/>
        <Variable Name="Phone" Path="phone"/>
        <Variable Name="Company" Path="company"/>
      </Variables>
      <Outputs>
        <Output Type="ContactUrl" Value="https://helpdesk.bernsergsolutions.com/yeastar?popup=helpdesk&amp;phone=[Phone]&amp;name=[FirstName] [LastName]"/>
        <Output Type="FirstName" Value="[FirstName]"/>
        <Output Type="LastName" Value="[LastName]"/>
        <Output Type="Email" Value="[Email]"/>
        <Output Type="Phone" Value="[Phone]"/>
        <Output Type="Company" Value="[Company]"/>
        <Output Type="EntityType" Value="Contacts"/>
        <Output Type="EntityId" Value="[ContactID]"/>
      </Outputs>
    </Scenario>
    <Scenario Id="ReportCall">
      <Request Url="[Protocol]://[ServerUrl]/functions/v1/yeastar-tickets" Method="POST" 
               RequestEncoding="JSON" RequestContentType="application/json">
        <Parameter Name="" Value="{&quot;ticket&quot;: {&quot;subject&quot;: &quot;Call from [CallStartTime] - [CallerNumber] to [CalleeNumber]&quot;, &quot;description&quot;: &quot;Call Details:\\n- From: [CallerNumber]\\n- To: [CalleeNumber]\\n- Duration: [CallDuration]\\n- Date: [CallStartTime]\\n- Type: [CallType]&quot;, &quot;priority&quot;: &quot;normal&quot;, &quot;status&quot;: &quot;new&quot;, &quot;tags&quot;: [&quot;3cx-call&quot;, &quot;[CallType]&quot;]}}"/>
      </Request>
      <Rules>
        <Rule Type="Any">ticket</Rule>
      </Rules>
      <Variables>
        <Variable Name="TicketID" Path="ticket.id"/>
        <Variable Name="TicketNumber" Path="ticket.ticket_number"/>
      </Variables>
      <Outputs>
        <Output Type="EntityType" Value="Tickets"/>
        <Output Type="EntityId" Value="[TicketID]"/>
        <Output Type="ContactUrl" Value="https://helpdesk.bernsergsolutions.com/tickets/[TicketID]"/>
      </Outputs>
    </Scenario>
  </Scenarios>
</Crm>